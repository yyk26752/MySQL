### 索引

索引是一个单独的、存储在磁盘上的数据库结构，它们包含着对数据表里的所有记录的引用指针。使用索引可以快速的找出在某个列或某多个列中特定值的行，所有的列类型都可以被索引。

索引的优缺点：

-   优点：可以大大提高查询效率。
-   缺点：
    -   创建索引和维护索引要耗费时间，并且随着数据量的增加所耗费的时间也会增加
    -   索引需要占磁盘空间，如果有索引过多，索引文件可能过大。
    -   当对表中数据进行增删改的时候，索引也需要动态维护，这会降低效率



#### B+树

![img](https://upload-images.jianshu.io/upload_images/7862980-1347d7c27ee3362c.png?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp) 

它是一颗平衡树，只有叶子节点才会有数据（不只一个数据），其他节点都是索引。叶子节点的关键字从小到大有序排列。每个叶子节点都有一个指针，指向下一个数据，形成一个有序链表。 查询时，查询到某个叶子节点，在该叶子节点中进行遍历，直到查找到数据或者查找不到。

相比于B树，B+树的特点：

-   B+树的高度更少：B+每个非叶子节点存储的是范围，使树的高度更少所以查询数据更快；
-   B+树查询速度更稳定：B+所有关键字数据地址都存在叶子节点上，所以每次查找的次数都相同所以查询速度要比B树更稳定;
-   B+树天然具备排序功能：B+树所有的叶子节点数据构成了一个有序链表；
-   B+树全节点遍历更快：B+树遍历整棵树只需要遍历所有的叶子节点即可，有利于数据库做全表扫描；



#### 聚集索引和非聚集索引

聚集索引（聚簇索引）：按照每张表的**主键**构造一颗B+树，同时叶子节点中存放的就是表的行记录数据，也将聚集索引的叶子节点称为数据页。索引组织表中，数据也是索引的一部分。如果数据表没有主键或者一个合适的唯一索引， InnoDB会生成一个隐藏的聚簇索引。 每张表只能有一个聚集索引。

非聚集索引（非聚簇索引、辅助索引）：用在非主键列上，一个表中可以拥有多个非聚集索引。叶子节点并不包含行记录数据，而是聚集索引键（主键ID）。当通过辅助索引来寻找数据时，lnnoDB 存储引擎会遍历辅助索引获得主键，再使用主键通过聚集索引获取行记录数据。

不管以任何方式查询表， 最终都会利用主键通过聚集索引来定位到数据， **聚集索引（主键）是获取真实数据所在的唯一路径。** 

许多数据库的文档会这样告诉读者：聚集索引按照顺序物理地存储数据。试想一下，如果聚集索引必须按照特定顺序存放物理记录，则维护成本显得非常之高（添加，删除）。所以，聚集索引的存储并不是物理上连续的，而是**逻辑上连续的**。叶子节点通过双向链表链接，实现逻辑上连续，物理上不一定连续。《MySQL技术内幕InnoDB存储引擎》。





#### 创建索引

如果字段是字符串类型，需要指定长度，且长度与定义字段时的一致。

如果是整型，可以不填长度。

```sql
create index 索引名称 on 表名(字段(长度));

create index index_id on students(id);
create index index_name on students(name(10));


--- 删除索引
drop index 索引名称 on 表名;
```





**应尽量避免在where子句中使用or来连接条件** 

使用or可能会使索引失效，从而进行全表扫描。如果or前面的有索引，or后面的语句没有索引，那么前面会走索引，后面的还是全表扫描，相当于三步过程：索引扫描+全表扫描+合并。如果一开始就全表扫描，那么只需要一遍扫描。
